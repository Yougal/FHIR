<!DOCTYPE html>
<html>
<head lang="en">
    <base href="/" />
    <meta charset="UTF-8">
    <script src="js/libs/jquery-1.9.0.min.js"></script>
    <script src="js/libs/angular.min1-5.js"></script>

    <script src="js/libs/ui-bootstrap-tpls-2.0.1.min.js"></script>

    <script src="js/libs/moment.min.js"></script>
    <script src="js/libs/lodash.core.js"></script>

    <link rel="stylesheet" type="text/css" href="css/jsTreeStyle.css"/>
    <link rel="stylesheet" type="text/css" href="css/jsTreeThemes/proton/style.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>

    <link rel="stylesheet" type="text/css" href="css/angular-lightweight-markdown-editor.css"/>

    <script src="js/libs/angular-sanitize.js"></script>
    <script src="js/libs/jstree.min.js"></script>

    <script src="js/libs/firebase.js"></script>
    <script src="js/libs/angularfire.min.js"></script>

    <script src="js/libs/angular-bootstrap-checkbox.js"></script>

    <script src="js/libs/upndown.bundle.min.js"></script>
    <script src="js/libs/showdown.min.js"></script>
    <style>

        .nb-modal-windowDEP .modal-dialog {
            width: 1200px;
        }

        .resourceInDocTreeDEP {
            border: 1px solid gainsboro;
            padding : 5px;
            margin: 8px;
            padding-bottom: 25px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
            background-color: #f3f3f3;
        }

        #resourceGraph {
             width: 100%;
             height: 550px;
             border: 1px solid lightgray;
         }

        #libraryGraph {
            width: 100%;
            height: 550px;
            border: 1px solid lightgray;
        }

        .pass {
            color:green;
        }
        .fail {
            color:red;
        }

        .profile {
            color: #4cae4c;
            float:right;
            margin :0px;
            padding:0px;
            padding-left : 3px;
            padding-right : 3px;

        }

        .logical {
            color: #ce8483;
            float:right;
            margin :0px;
            padding:0px;
            padding-left : 3px;
            padding-right : 3px;
        }

        .libraryScroll {
            height: 600px;
            overflow-y: scroll;
        }


    </style>

    <script>

        //https://github.com/rallu/angular-lightweight-markdown-editor


        angular.module("sampleApp",['ui.checkbox','ui.bootstrap','ngStorage','ngSanitize','firebase']).config(function($locationProvider) {

            // enable html5Mode for pushstate ('#'-less URLs)
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');
        });
        angular.module("sampleApp").constant("moment", moment);

        angular.module("sampleApp").config(['$compileProvider','$httpProvider', function ($compileProvider,$httpProvider) {
            //$compileProvider.aHrefSanitizationWhitelist(/^\s*(|blob|):/);       //allows download
//'$compileProvider',
            //disable GET caching
            //initialize get if not there

            if (!$httpProvider.defaults.headers.get) {
                $httpProvider.defaults.headers.get = {};
            }

          //  $httpProvider.defaults.headers.get['Pragma'] = 'no-cache';

            /*
            $httpProvider.defaults.headers.get['If-Modified-Since'] = 'Mon, 26 Jul 1997 05:00:00 GMT';
            $httpProvider.defaults.headers.get['Cache-Control'] = 'no-cache';
            $httpProvider.defaults.headers.get['Pragma'] = 'no-cache';
            */

        }]);
/*
        myModule.config(['$httpProvider', function($httpProvider) {
            //initialize get if not there
            if (!$httpProvider.defaults.headers.get) {
                $httpProvider.defaults.headers.get = {};
            }

            // Answer edited to include suggestions from comments
            // because previous version of code introduced browser-related errors

            //disable IE ajax request caching
            $httpProvider.defaults.headers.get['If-Modified-Since'] = 'Mon, 26 Jul 1997 05:00:00 GMT';
            // extra
            $httpProvider.defaults.headers.get['Cache-Control'] = 'no-cache';
            $httpProvider.defaults.headers.get['Pragma'] = 'no-cache';
        }]);

*/

        window.onerror = function(message, url, linenumber) {
            alert("An unexpected error occurred: " + message + " on line " + linenumber + " for " + url);
        }

    </script>
    <script src="js/builderCtrl.js"></script>
    <script src="js/builderSvc.js"></script>
    <script src="js/modalDialogSvc.js"></script>
    <script src="js/appConfigSvc.js"></script>
    <script src="js/libs/ngStorage.min.js"></script>
    <script src="resourceBuilder/rbServices.js"></script>
    <script src="js/logicalModelSvc.js"></script>
    <script src="js/resourceCreatorSvc.js"></script>
    <script src="js/profileCreatorSvc.js"></script>
    <script src="js/resourceSvc.js"></script>
    <script src="js/services.js"></script>
    <script src="js/filters.js"></script>
    <!--
    <script src="js/libs/vis.min.js"></script>
    -->
    <script src="js/addPropertyInBuilderCtrl.js"></script>
    <script src="js/docBuilderCtrl.js"></script>
    <script src="js/findPatientCtrl.js"></script>

    <script src="resourceBuilder/selectProfile.js"></script>
    <script src="js/components/profileDisplayComp.js"></script>
    <script src="resourceBuilder/vsBrowser.js"></script>
    <script src="js/setServers.js"></script>
    <script src="js/resourceViewerCtl.js"></script>
    <script src="js/observationsDisplayCtrl.js"></script>
    <script src="js/libs/vis.min.js"></script>
    <script src="js/loginCtrl.js"></script>
    <script src="js/addExtensionCtrl.js"></script>
    <script src="js/dataTypeCtrl.js"></script>
    <script src="js/markerSvc.js"></script>
    <script src="js/sbHistorySvc.js"></script>
    <script src="js/sbHistoryCtl.js"></script>
    <script src="js/refreshScenario.js"></script>
    <script src="directive/fhirpath/fhirpath.js"></script>

    <script src="directive/questionnaire/questionnaireCtl.js"></script>
    <script src="js/questionnaireSvc.js"></script>
    <script src="js/profileDiffSvc.js"></script>


    <!-- following are for newBuilder...-->
    <script src="js/newBuilderCtl.js"></script>
    <script src="js/newBuilderSvc.js"></script>

    <script src="js/sessionSvc.js"></script>
    <script src="js/addScenarioCrtl.js"></script>

    <script>
        var config = {
            apiKey: "AIzaSyBNMohLbPiSKwpGwfARopdeW_6LLXujcUo",
            authDomain: "clinfhir.firebaseapp.com",
            databaseURL: "https://clinfhir.firebaseio.com",
            storageBucket: ""
        };

        if (firebase) {
            firebase.initializeApp(config);

        }
    </script>

    <title>Scenario Builder</title>


</head>


<body style="padding: 8px;padding-top: 80px" >

    <div ng-app="sampleApp" ng-controller="builderCtrl" class="container-fluid">


        <nav ng-hide="startupParams.hideNav" class="navbar navbar-default navbar-fixed-top" role="navigation">

            <div class="container-fluid row">
                <div class="col-md-1 col-sm-1">
                    <a class="navbar-brand" href="#"
                       uib-popover-html="displayServers"
                       popover-trigger="'mouseenter'"
                       popover-placement="right">
                        Scenario Builder
                    </a>
                </div>


                <div class="col-md-4 col-sm-4">

                    <div class="navbar-text">
                        <div class='clickable' ng-show="resourcesFromServer" ng-click="togglePatientDisplay()">
                            {{ResourceUtilsSvc.getOneLineSummaryOfResource(currentPatient)}}
                        </div>

                        <a ng-show = "showSelector && thingToDisplay=='scenario' " href="#" ng-click="toggleSelector()">Show Selector</a>
                        <a ng-hide = "showSelector || thingToDisplay!=='scenario'" href="#" ng-click="toggleSelector()">Hide Selector</a>

                    </div>
                </div>
                <div class="col-md-2 col-sm-2">
                    <div class="navbar-text" ng-show="thingToDisplay=='scenario'">
                        <div><a href="#" ng-click="importResource()">Import resource</a></div>
                        <div ng-show="selectedContainer.showVersion"><a href="#" ng-click="toggleVersion()">Hide version</a></div>
                        <div ng-hide="!selectedContainer || selectedContainer.showVersion">
                            <a href="#" ng-click="toggleVersion()">Show version</a>
                        </div>
                    </div>

                </div>


                <div ng-show = "1==2" class="col-md-1 col-sm-1">
                    <div class="navbar-text">
                        <!-- <a href="#" ng-hide="recording" ng-click="recording = true">Start Recording</a>
                        <a href="#" ng-show="recording" ng-click="recording = false">Stop Recording</a>
                        -->
                        <div>
                            <a href="#" ng-hide="thingToDisplay=='recording' || selectedContainer.tracker.length < 1"
                               ng-click="thingToDisplay='recording'">View all changes
                                <span class="badge">{{selectedContainer.tracker.length}}</span> </a>
                            <a href="#" ng-show="thingToDisplay=='recording'" ng-click="thingToDisplay='scenario'">View Scenario</a>
                        </div>

                    </div>



                    <div class="navbar-text" ng-show="1==2">

                        <!-- Show the 'save to library' only in scenario mode, when there are changes-->
                        <div ng-show="thingToDisplay=='scenario' && selectedContainer.isDirty"
                             class="clickable" ng-click="saveToLibrary()">Save to Library</div>

                        <!-- display a 'show library' link, unless the library is already shown -->
                        <div ng-hide="thingToDisplay=='library'">
                            <span class="clickable" ng-click="thingToDisplay = 'library'">View Library</span>
                        </div>

                        <!-- display a 'hide library' link, the library is  shown -->
                        <div ng-show="thingToDisplay=='library'">
                            <span class="clickable" ng-click="thingToDisplay = 'scenario'">Hide Library</span>
                        </div>

                    </div>
                </div>


                <div class="col-md-2 col-sm-2">

                    <div class="navbar-text" ng-show="thingToDisplay=='scenario'">
                        <div class="clickable" ng-click="validateAll()">Validate All</div>
                        <div class="clickable" ng-click="saveToFHIRServer()">Update Server</div>
                    </div>
                </div>


                <div class="col-md-1 col-sm-1">
                    <div class="navbar-text" ng-show="thingToDisplay=='scenario'">
                        <div class="clickable" ng-click="refreshScenarioFromServer()"
                             uib-popover="Refresh scenario from server"
                             popover-placement="left"
                             popover-trigger="'mouseenter'"

                        >Refresh</div>
                    </div>
                </div>


                <div class="col-md-2 col-sm-2">

                    <div class="pull-right navbar-form" ng-show="waiting">
                        <img src="css/ajax_loader_blue_32.gif"/>
                    </div>

                    <div ng-hide="waiting">
                        <div class="nav navbar-form navbar-right" ng-hide="firebase.auth().currentUser">
                        <span style="font-size:1.8em; cursor: pointer">
                            <div ng-click="login()">
                                <i class="glyphicon glyphicon-log-in"></i>
                            </div>
                        </span>
                        </div>

                        <div class="nav navbar-form navbar-right" ng-show="firebase.auth().currentUser">
                        <span style="font-size:1.8em; cursor: pointer"
                              uib-popover="{{firebase.auth().currentUser.email}}"
                              popover-placement="left"
                              popover-trigger="'mouseenter'">
                            <div href="#" ng-click="logout()"> <i class="glyphicon glyphicon-log-out"></i></div>
                        </span>
                        </div>
                    </div>

                    <ul class="nav navbar-nav navbar-right"  ng-hide="waiting">
                        <li uib-dropdown>
                            <a href="#" uib-dropdown-toggle>
                                <span style="font-size:2em; cursor: pointer">
                                        <i class="glyphicon glyphicon-cog"></i>
                                </span>
                            </a>


                            <ul class="dropdown-menu" role="menu">

                                <li ng-show="thingToDisplay=='scenario' && selectedContainer.isDirty">
                                    <a href="#" ng-click="saveToLibrary()">Save to Library</a>
                                </li>


                                <li ng-hide="thingToDisplay=='library'">
                                    <a href="#" ng-click="thingToDisplay = 'library'">View Library</a>
                                </li>

                                <li ng-show="thingToDisplay=='library'">
                                    <a href="#" ng-click="thingToDisplay = 'scenario'">Hide Library</a>
                                </li>


                                <li ng-hide="thingToDisplay=='recording' || selectedContainer.tracker.length < 1">
                                    <a href="#"
                                       ng-click="thingToDisplay='recording'">View all changes
                                        <span class="badge">{{selectedContainer.tracker.length}}</span> </a>
                                </li>

                                <li ng-show="thingToDisplay=='recording'">
                                    <a href="#" ng-click="thingToDisplay='scenario'">View Scenario</a>
                                </li>


                            </ul>
                        </li>
                    </ul>

                </div>
<!--
                <div class="col-md-1 col-sm-1">
                    <ul class="nav navbar-nav navbar-right"  ng-hide="waiting">
                    <li uib-dropdown>

                        <a href="#" uib-dropdown-toggle>
                        <span style="font-size:2em; cursor: pointer">
                            <i class="glyphicon glyphicon-cog"></i>
                        </span>
                        </a>



                        <ul class="dropdown-menu" role="menu">


                            <li>
                                <a href="#" ng-click="showChart()" ng-hide="displayMode=='access'"
                                   uib-popover="Show how many people are using clinFHIR"
                                   popover-placement="left"
                                   popover-trigger="'mouseenter'">Access statistics</a>
                            </li>

                            <li>
                                <a href="#" ng-click="displayMode = 'front'" ng-hide="displayMode=='front'"
                                   uib-popover="Show the main Launcher screen"
                                   popover-placement="left"
                                   popover-trigger="'mouseenter'">Launcher</a>
                            </li>

                        </ul>
                    </li>
                </ul>
                </div>
                -->

            </div>
        </nav>


        <!-- The 4 display modes - Library, Scenario Builder, Patient data, Recording/tracker  -->

        <div ng-show="thingToDisplay=='recording'" ng-controller="sbHistoryCtrl">
            <ng-include src="'/includes/sbHistoryViewer.html'"></ng-include>
        </div>

        <div ng-show="thingToDisplay=='patient'" ng-controller="resourceViewerCtrl">
            <div class="banner">
                Showing resources for this patient that are on the Data Server
                <div style="font-weight:normal">(Click the name again to return to the Scenario Builder)</div>
            </div>
            <ng-include src="'/includes/resourceViewer.html'"></ng-include>
        </div>

        <div class="row" ng-show="thingToDisplay=='library'">

            <div class="banner">
                The Library of all Scenarios. Saved on the Data Server as DocumentReference resources.
                <div style="font-weight:normal">(Select the type of entry. Click the 'Hide Library' link in the toolbar above to return to the Scenario Builder)</div>
            </div>


            <div class="row">
                <div class="col-md-2 col-sm-2">

                    <div style="margin-bottom: 10px">
                        <select class="form-control" ng-model="input.selectedLibraryCategory"
                                ng-change="makeLibraryDisplayList(input.selectedLibraryCategory)"
                                ng-options="concept.display for concept in libraryCategories.concept">
                        </select>
                    </div>

                    <div class="libraryScroll">
                        <ul class="list-group" >
                        <li style="cursor: pointer" ng-class="{'list-group-item':1==1,'list-group-item-info':$index == currentLibraryIndex}"
                            ng-repeat="container in selectedLibraryList"
                            ng-click="selectLibraryContainer(container,$index)">

                            <div class="row">
                                <div class="col-md-10 col-sm-10">

                                    <strong>{{container.name}}</strong>
                                    <div><em>{{container.description | limitTo: 20}}</em></div>
                                </div>
                                <div class="col-md-2 col-sm-2">
                                    <div ng-hide="container.cachedLocally">
                                        <i class="glyphicon glyphicon-cloud-download"
                                           title="Download"
                                           ng-click="downloadFromLibrary(container,$index)" style="cursor: pointer">

                                        </i>
                                    </div>

                                </div>

                            </div>

                        </li>
                    </ul>
                    </div>

                </div>

                <div class="col-md-10 col-sm-10">


                    <div class="row" ng-show="selectedLibraryContainer">
                        <div class="col-md-6 col-sm-6">
                            <h4>Details</h4>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Name:
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    {{selectedLibraryContainer.name}}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Description:
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    {{selectedLibraryContainer.description}}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Category:
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    {{selectedLibraryContainer.category.display}}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Url:
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    {{selectedLibraryContainer.url}}
                                </div>
                            </div>
                            <div class="row" ng-repeat = "author in selectedLibraryContainer.author">
                                <div class="col-md-3 col-sm-3">
                                    Author:
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    {{author.display}}
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Last Updated:
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    {{selectedLibraryContainer.lastUpdated | date:'EEE MMM d, H:mm'}}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Version:
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    {{selectedLibraryContainer.version}}
                                </div>
                            </div>

                            <div id="libraryGraph"></div>
                            <br/>


                            <div ng-show="canDeleteLibraryEntry">
                                <button ng-click="deleteScenario(selectedLibraryContainer)" class="pull-right btn btn-danger">Delete Scenario</button>
                            </div>


                        </div>


                        <div class="col-md-6 col-sm-6">
                            <h4>Resources</h4>
                            <ul class="list-group">
                                <li class="list-group-item" ng-repeat= "item in selectedLibraryContainer.resources">


                                    <a target="_blank" ng-href="{{fhirBasePath}}{{item.type | referenceType | lowercase}} ">
                                        {{item.type}}
                                    </a>

                                     <span class="badge">{{item.count}}</span>
                                </li>
                            </ul>
                        </div>
                    </div>



                </div>

            </div>



        </div>

        <div class="row" ng-show="thingToDisplay=='scenario'">


            <div ng-class="leftPaneClass">

                <button class="btn btn-link pull-right" ng-click="newBundle()">New Scenario</button>
                <h4>Local Scenarios</h4>

                <ul class="list-group" >
                    <li style="cursor: pointer" ng-class="{'list-group-item':1==1,'list-group-item-info':$index == currentBundleIndex}"
                        ng-repeat="entry in builderBundles"
                        ng-click="selectBundle($index)">

                        <div class="row">
                            <div class="col-md-10 col-sm-10">
                                <strong>{{entry.name}}</strong>
                            </div>
                            <div class="col-md-2 col-sm-2">

                                <i class="glyphicon glyphicon-remove"
                                   title="Delete"
                                   ng-click="deleteBundle($index)" style="cursor: pointer">

                                </i>
                            </div>

                        </div>

                        <div class="row">
                            <div class="col-md-10 col-sm-10">
                                {{entry.description | limitTo : 50}}
                            </div>
                        </div>

                    </li>
                </ul>

            </div>
            <div ng-class="midPaneClass">

                <div ng-hide="selectedContainer">
                    <div uib-alert class="alert-warning">
                        To edit a scenario, you can either:
                        <ul>
                            <li>Click the 'New Scenario' link to the left to create a new Set</li>
                            <li>Select the Library of scenarios ('View Library' link to the upper right) and download one to edit or view</li>
                        </ul>
                    </div>
                </div>

                <div ng-show="selectedContainer">

                    <div ng-show="selectedContainer.showVersion">
                        <div class="row" >
                            <div class="col-md-11 col-sm-11">
                                <ul class="pagination" style="margin-top:1px;margin-bottom:1px">
                                    <li><a href="#"><strong>Versions:</strong></a></li>

                                    <li ng-class="{active:selectedContainer.index == $index}" ng-repeat="hx in selectedContainer.history">
                                        <a    href="#" ng-click="selectScenarioVersion($index)">{{$index}}</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-1 col-sm-1">
                                <i class="glyphicon glyphicon-plus" ng-show="builderSvc.isVersionMostRecent(selectedContainer)"
                                   ng-click="setNewScenarioVersion()" style="cursor: pointer">

                                </i>
                            </div>
                        </div>
                        <hr/>
                    </div>

                    <button ng-hide="displayMode == 'new' || ! builderSvc.isVersionMostRecent(selectedContainer) || inputMode"
                            ng-click="displayMode = 'new'"
                            class="btn btn-primary pull-right">Add Resource</button>

                    <div ng-show="! builderSvc.isVersionMostRecent(selectedContainer)" class="pull-right">
                        Read only (version {{selectedContainer.index}})
                    </div>

                    <uib-tabset>

                        <uib-tab heading="List">
                            <br/>

                            <div class="row"  style="height:550px; overflow-y: auto;" >
                                <div class="col-md-12 col-sm-12">


                                    <uib-tabset>
                                        <uib-tab heading="List">

                                            <table class="table table-bordered table-condensed">
                                                <tr><th>Type</th><th>Text</th><th>Valid</th></tr>
                                                <tr ng-repeat="entry in selectedContainer.bundle.entry">
                                                    <td width="30%">
                                                        <div class='clickable' ng-click="selectResource(entry)">
                                                            {{entry.resource.resourceType}}

                                                            <span ng-show="entry.isProfile"
                                                                  uib-popover="{{entry.profile}}"
                                                                  popover-placement="right"
                                                                  popover-trigger="'mouseenter'"

                                                                  class="rounded-box profile">profile
                                                    </span>
                                                            <span ng-show="entry.isLogical"
                                                                  uib-popover="Logical models cannot be saved on the FHIR server"
                                                                  popover-placement="right"
                                                                  popover-trigger="'mouseenter'"
                                                                  class="rounded-box logical">logical
                                                    </span>

                                                        </div>

                                                    </td>
                                                    <td>
                                                        <p ng-bind-html="entry.resource.text.div"></p>



                                                    </td>
                                                    <td>
                                                        <div ng-hide="entry.isLogical" ng-switch on="entry.valid" ng-click="validate(entry)">    <!-- todo - not a real bundlemember-->
                                                            <div ng-switch-when="yes">
                                                                <i class="glyphicon glyphicon-ok clickable pass"
                                                                   title="Resource is valid">
                                                                </i>
                                                            </div>
                                                            <div ng-switch-when="no">
                                                                <i class="glyphicon glyphicon-remove clickable fail"
                                                                   title="Resource is not valid">
                                                                </i>
                                                            </div>
                                                            <div ng-switch-when="saved">
                                                                <i class="glyphicon glyphicon-thumbs-up pass"
                                                                   title="Resource is valid">
                                                                </i>
                                                            </div>
                                                            <div ng-switch-default>
                                                                <i class="glyphicon glyphicon-question-sign clickable"
                                                                   title="Validity not yet checked">
                                                                </i>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>


                                        </uib-tab>
                                        <uib-tab heading="Report">
                                            <button class="btn btn-link" ng-click="makeElementsPopulatedReport()">Make report</button>


                                            <div ng-repeat="res in populatedReport">
                                                <div class="row">
                                                    <div class="col-md-12 col-sm-12">
                                                        <div class="banner">{{res.resourceType}}</div>
                                                    </div>
                                                </div>


                                                <div class="row" ng-repeat="ele in res.elements">
                                                    <div class="col-md-6 col-sm-6">
                                                        {{ele.path}}
                                                    </div>
                                                    <div class="col-md-6 col-sm-6">
                                                        {{ele.text}}
                                                    </div>
                                                </div>




                                            </div>
                                        </uib-tab>
                                    </uib-tabset>






                                </div>

                            </div>



                        </uib-tab>




                        <uib-tab heading="Description">
                            <br/>

                            <uib-tabset>
                                <uib-tab heading = "Summary">

                                    <br/>

                                    <form class="form-horizontal" role="form">

                                        <div class="form-group">
                                            <div class="col-md-3 col-sm-3">
                                                <strong>Scenario name</strong>
                                            </div>
                                            <div class="col-md-8 col-sm-8">
                                                <div ng-show="input.renameScenario">
                                                    <input type="text" ng-model = 'input.newName' class="form-control" placeholder="New scenario name">
                                                    <div><div class="pull-right">
                                                        <a href="#" ng-click="renameScenario(input.newName)">Rename (and take ownership)</a>
                                                    </div> </div>
                                                </div>
                                                <div ng-hide="input.renameScenario">{{selectedContainer.name}}</div>

                                            </div>

                                            <div class="col-md-1 col-sm-1">
                                                <i class="glyphicon glyphicon-edit iconSpacing pull-right"
                                                   ng-click="input.renameScenario = ! input.renameScenario"
                                                   title="Rename scenario"></i>

                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-md-3 col-sm-3">
                                                <strong>Description</strong>
                                            </div>
                                            <div class="col-md-9 col-sm-9">
                                                <textarea class="form-control" ng-change="setDirty()"
                                                          ng-model = 'selectedContainer.description'></textarea>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-md-3 col-sm-3">
                                                <strong>Category</strong>
                                            </div>
                                            <div class="col-md-8 col-sm-8">
                                                {{selectedContainer.category.display}}

                                                <div ng-show="changeScenarioCategory">
                                                    <select class="form-control" ng-model="input.selectedScenarioCategory"
                                                            ng-change="changeSelectedScenarioConcept(input.selectedScenarioCategory);changeScenarioCategory = false"
                                                            ng-options="concept.display for concept in libraryCategories.concept">
                                                    </select>
                                                </div>

                                            </div>
                                            <div class="col-md-1 col-sm-1">
                                                <i class="glyphicon glyphicon-edit iconSpacing pull-right"
                                                   title="Edit category"
                                                   ng-click="changeScenarioCategory = !changeScenarioCategory" style="cursor: pointer">

                                                </i>
                                            </div>

                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-3 col-sm-3">
                                                <strong>Servers when created</strong>
                                            </div>
                                            <div class="col-md-8 col-sm-8">

                                                <div class="row" ng-repeat="(key,value) in selectedContainer.server">
                                                    <div class="col-md-4 col-sm-4">
                                                        {{key}}
                                                    </div>
                                                    <div class="col-md-8 col-sm-8">
                                                        {{value.name}}
                                                    </div>

                                                </div>
                                            </div>

                                        </div>


                                        <div class="form-group" >
                                            <div class="col-md-3 col-sm-3">
                                                <strong>Patient</strong>
                                            </div>
                                            <div class="col-md-9 col-sm-9">

                                                <div ng-show="currentPatient">

                                                    <div ng-show="resourcesFromServer">
                                                        {{ResourceUtilsSvc.getOneLineSummaryOfResource(currentPatient)}}
                                                    </div>

                                                    <div ng-hide="resourcesFromServer">
                                                        There is a Patient resource in the scenario, but it was not retrieved
                                                        from the server (ie it's been created locally for this scenario either by
                                                        you, or by the scenario author if downloaded from the Library).
                                                    </div>


                                                </div>

                                                <div ng-hide="currentPatient">
                                                    There is no patient resource.
                                                    Click <a href="#" class="rounded-box" ng-click="findPatient()">here</a>
                                                    to find or add one from the server.</textarea>
                                                </div>

                                            </div>
                                        </div>


                                        <div class="form-group">
                                            <div class="col-md-3 col-sm-3">

                                                <strong>Url</strong>
                                            </div>
                                            <div class="col-md-9 col-sm-9">
                                                {{selectedContainer.url}}
                                            </div>
                                        </div>

                                        <div class="form-group" ng-repeat = "author in selectedContainer.author">
                                            <div class="col-md-3 col-sm-3">

                                                <strong>Author</strong>
                                            </div>
                                            <div class="col-md-9 col-sm-9">
                                                {{author.display}} <span ng-show="author.email">({{author.email}})</span>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-md-3 col-sm-3">

                                                <strong>Last Updated</strong>
                                            </div>
                                            <div class="col-md-9 col-sm-9">
                                                {{selectedContainer.lastUpdated}}
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-md-3 col-sm-3">

                                                <strong>Version</strong>
                                            </div>
                                            <div class="col-md-9 col-sm-9">
                                                {{selectedContainer.version}}
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-md-3 col-sm-3">

                                                <strong>Bundle Id</strong>
                                            </div>
                                            <div class="col-md-9 col-sm-9">
                                                {{selectedContainer.bundle.id}}
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <div class="col-md-12 col-sm-12">
                                                <div class="alert alert-warning" role="alert"
                                                     ng-show="selectedContainer.isDirty">
                                                    There are changes that are saved locally, but not yet updated to the Library
                                                </div>
                                            </div>
                                        </div>





                                    </form>

                                </uib-tab>

                                <uib-tab heading = "Bundle Json">
                                    <br/>
                                    <div  class="clearfix">
                                    <em>All the resources in the scenario as a bundle</em>

                                        <button class="btn btn-link pull-right" ng-click="downloadBundle()">Download</button>

                                    </div>
                                    <pre>{{getBundleDisplay(selectedContainer.bundle)  | json}}</pre>
                                    <!-- <pre>{{selectedContainer.bundle | bundleDisplay | json}}</pre>-->
                                </uib-tab>



                                <uib-tab heading = "Container Json">
                                    <br/>
                                    <div>
                                        <a class=" rounded-box pull-right" ng-show="downloadLinkJsonContent" download="{{downloadLinkJsonName}}.json"
                                           href="{{downloadLinkJsonContent}}"> Download scenario
                                        </a>

                                    </div>
                                    <pre>{{selectedContainer | containerMeta  | json}}</pre>
                                </uib-tab>
                            </uib-tabset>






                        </uib-tab>

                        <uib-tab heading="Graph" select="redrawChart()">
                            <div class="row">
                                <div class="col-md-12 col-sm-12">


                                    <a ng-show = "graphZoom" href="#" ng-click="toggleGraphZoom()">UnZoom Graph</a>
                                    <a ng-hide = "graphZoom" href="#" ng-click="toggleGraphZoom()">Zoom Graph</a>



                                     <span class="clickable iconSpacing pull-right" ng-show="filteredGraphView"
                                           ng-click="showAllInGraph()">Show All</span>

                                    <span class="clickable iconSpacing pull-right"
                                          ng-hide="hidePatientFlag" ng-click="hidePatient()">Hide Patient</span>


                                    <span class="clickable iconSpacing pull-right"
                                          ng-show = "currentResource"
                                          ng-click="hideOthers()">Show direct references to {{currentResource.resourceType}} only </span>
                                </div>
                            </div>
                            <div id="resourceGraph"></div>
                            <br/>
                        </uib-tab>
                        <uib-tab ng-show = "isaDocument" heading="Document">
                            <div ng-controller="docBuilderCtrl">

                                <ng-include src="'/includes/documentBuilderInc.html'"></ng-include>



                            </div>
                        </uib-tab>

                        <uib-tab heading="FHIRPath">
                            <br/>

                            <fhirpath resource="selectedContainer.bundle"></fhirpath>
                            <hr/>
                            <pre>{{selectedContainer.bundle | json}}</pre>

                        </uib-tab>

                        <uib-tab heading="Mark">
                            <br/>






                            <div class="row">
                                <div class="col-sm-10 col-md-10">
                                    <div><em>Select the Bundle to compare this one with...</em></div>
                                    <select class="form-control" ng-model="input.markReference"
                                            ng-options="container.name for container in referenceContainers">

                                    </select>
                                </div>
                                <div class="col-sm-2 col-md-2">
                                    <div>&nbsp;</div>
                                    <button ng-show="input.markReference" class="btn btn-danger pull-right"
                                            ng-click="scoreBundle(input.markReference)">Mark</button>
                                </div>
                            </div>

                            <div class="rounded-box" ng-show="markResult">
                                <ng-include src="'/includes/markerResult.html'"></ng-include>
                            </div>


                        </uib-tab>



                    </uib-tabset>






                </div>


            </div>
            <div ng-class="rightPaneClass" >

<!--
                <pre>{{selectedContainer.history | json}}</pre>
-->

                <div ng-show="displayMode == 'view'">

                    <div ng-show="currentReference">
                        <h5>Details of Reference</h5>
                        <div><strong>From: </strong>{{currentReference.from.cf.resource.resourceType}}</div>

                        <div><strong>Path: </strong>{{currentReference.from.cf.resource.resourceType}}.{{currentReference.fromPath}}</div>
                        <div><strong>To: </strong>{{currentReference.to.cf.resource.resourceType}}</div>

                    </div>

                    <uib-tabset ng-show="currentResource">

                        <div class="banner">
                            <div>{{currentResource | manualText | limitTo:75}}</div>
                            <div style="font-weight: 200"><em>{{currentResource.resourceType}} {{currentResource.id}}</em></div>

                            <!--
                            <span ng-bind-html="currentResource | manualText"></span>
                            -->
                        </div>
                        <uib-tabset>

                            <uib-tab  ng-show="builderSvc.isVersionMostRecent(selectedContainer)" heading="Structure & Reference">

                                <div class="row">
                                    <div class="col-sm-12 col-md-12">



                                        <span class="clickable pull-right iconSpacing"
                                              ng-click="toggleInputMode()">Toggle Input Mode</span>
                                    </div>
                                </div>

                                <div class="row"  ng-show="builderSvc.isVersionMostRecent(selectedContainer)" >

                                    <div ng-class="inputTreeClass">

                                        <span class="pull-right">
                                            <a target="_blank" ng-href="{{fhirBasePath}}{{currentResource.resourceType | getLogicalID | lowercase}}.html">
                                            <i class="glyphicon glyphicon-globe"
                                               title="View Resource definition in spec">
                                            </i>

                                        </a>
                                        </span>

                                        <div id="SDtreeView"></div>
                                    </div>



                                    <div ng-class="inputDTSelectClass">




                                        <div class="row">
                                            <div class="col-md-9 col-sm-9">
                                                <div class="rounded-box"><p ng-bind-html="currentResource.text.div"></p></div>
                                            </div>
                                            <div class="col-md-3 col-sm-3">
                                                <i class="glyphicon glyphicon-edit iconSpacing pull-right"
                                                   title="Edit text"
                                                   ng-click="editResource(currentResource)" style="cursor: pointer">

                                                </i>


                                                <br />
                                                <i class="glyphicon glyphicon-remove iconSpacing pull-right"
                                                   title="Delete resource"
                                                   ng-click="removeResource(currentResource)" style="cursor: pointer">

                                                </i>


                                            </div>
                                        </div>




                                        <br/>
                                        <div class="banner" ng-show="hashPath">{{hashPath.path}}</div>

                                        <div ng-show="currentElementValue.display">
                                            <h5>Current Value</h5>
                                            <div>{{currentElementValue.display}}</div>
                                            <br/>
                                        </div>


                                        <!-- show any existing elements that are parents of this element-->
                                        <div ng-show="existingElements.isMultipleBbe">
                                            <br/>

                                            <div class="row">
                                                <div class="col-sm-3 col-md-3">
                                                    <h5>Parent branches created</h5>
                                                </div>
                                                <div class="col-sm-6 col-md-6">
                                                    <ul class="pagination">
                                                        <li  ng-repeat="element in existingElements.list" ng-class="{active:$index==input.selectedExistingElement}">
                                                            <a href="#" ng-click="input.selectedExistingElement=$index">{{$index+1}}</a>
                                                        </li>
                                                    </ul>

                                                </div>
                                                <div class="col-sm-3 col-md-3">
                                                    <div><button class="btn btn-link" ng-click="addBBE()">Add Branch</button> </div>
                                                </div>

                                            </div>

                                            <pre>{{existingElements.list[input.selectedExistingElement] | json}}</pre>

                                        </div>


                                        <h5 ng-show="hashPath">DataType/s  (click to add data)</h5>
                                        <div ng-repeat="type in hashPath.ed.type">
                                            <div ng-hide="type.code == 'Reference'">

                                                <div>
                                                    <div class="pull-right">
                                                        <a target="_blank" ng-href="{{fhirBasePath}}datatypes.html#{{type.code}}">
                                                            <i class="glyphicon glyphicon-globe"
                                                               title="View Datatype in spec">

                                                            </i>

                                                        </a></div>
                                                </div>

                                                <span ng-class="{clickable:supportedDt.indexOf(type.code)>-1}"
                                                      ng-click="addValueForDt(hashPath,type.code,currentElementValue.display)">

                                                {{type.code}}
                                            </span>


                                            </div>
                                            <div ng-show="type.code == 'Reference'">
                                                <div>
                                                    <div class="pull-right">

                                                        <a ng-show="type.profile" target="_blank" ng-href="{{fhirBasePath}}{{type.profile | referenceType | lowercase}} ">
                                                            <i class="glyphicon glyphicon-globe"
                                                               title="View Resource in spec">

                                                            </i>
                                                        </a>

                                                        <a ng-show="type.targetProfile" target="_blank" ng-href="{{fhirBasePath}}{{type.targetProfile | referenceType | lowercase}} ">
                                                            <i class="glyphicon glyphicon-globe"
                                                               title="View Resource in spec">

                                                            </i>
                                                        </a>


                                                    </div>
                                                </div>
                                                <!-- allow for stu2 & 3-->
                                                --> {{type.profile | referenceType}} {{type.targetProfile | referenceType}}
                                            </div>

                                        </div>


                                        <!-- It appears that in R3, the root element no longer has a type... I add it in the controller...-->
                                        <div ng-show="hashPath.ed.type[0].code == 'DomainResource'">
                                            <br/>
                                            <div>
                                                <span class="clickable" ng-click="addExtensionDirectly()">Add Extension</span>
                                            </div>
                                        </div>




                                        <div ng-show="hashPath.isReference">



                                            <h5>Potential References</h5>




                                            <table class="table table-condensed table-bordered">
                                                <tr><th>Type</th><th>Potential resources</th></tr>
                                                <tr ng-repeat="(key,data) in hashReferences">
                                                    <td>{{key}}</td>
                                                    <td>
                                                        <table width="100%">
                                                            <tr ng-repeat = "resource in data">
                                                                <td>
                                                                    <div title="{{resource.resourceType}}" ng-bind-html="resource.text.div"></div>
                                                                </td>
                                                                <td>
                                                                    <div class="pull-right">

                                                                    <span>
                                                                        <i class="glyphicon glyphicon-plus"
                                                                           ng-click="linkToResource(hashPath.path,resource,hashPath)" style="cursor: pointer">

                                                                        </i>
                                                                    </span>
                                                                    </div>
                                                                </td>

                                                            </tr>
                                                        </table>


                                                    </td>

                                                </tr>
                                            </table>

                                        </div>



                                        <br/>

                                        <div ng-show="hashPath.ed.binding">
                                            <h5>ValueSet Binding ({{hashPath.ed.binding.strength}})</h5>
                                            <div>
                                                <button class="btn btn-link" ng-click="viewVS(hashPath.ed.binding)">
                                                    {{hashPath.ed.binding.valueSetReference.reference}}
                                                    {{hashPath.ed.binding.valueSetUri}}
                                                </button>


                                            </div>

                                            <div ng-show="expandedValueSet">
                                                <div><a href="#" ng-click="input.showCodeValues = ! input.showCodeValues" class="pull-right">
                                                    <span ng-show="input.showCodeValues">Hide</span><span ng-hide="input.showCodeValues">Show</span>
                                                    values
                                                </a>
                                                </div>
                                                <div ng-show ='input.showCodeValues'>
                                                    <table class="table table-condensed table-bordered">
                                                        <tr ng-repeat="concept in expandedValueSet.expansion.contains">
                                                            <td>{{concept.code}}</td>
                                                            <td>{{concept.display}}</td>
                                                            <td>{{concept.extension[0].valueString}}</td>

                                                        </tr>
                                                    </table>


                                                </div>
                                            </div>

                                        </div>
                                        <hr/>
                                        {{hashPath.definition}}

                                        {{hashPath.comments}}

                                    </div>

                                    <div ng-class="inputResourceClass">
                                        <pre>{{currentResource | json}}</pre>
                                    </div>
                                </div>



                            </uib-tab>

                            <uib-tab heading="Current resource views">
                                <br/>

                                <span class="clickable pull-right iconSpacing" ng-click="showQuest()">Edit</span>

                                <uib-tabset>


                                    <uib-tab heading="Tree">
                                        <br/>
                                        <button ng-show="canDeletePath()" class="btn btn-danger pull-right"
                                                ng-click="removeResourceNode(displayResourceTreeDeletePath)">Delete</button>

                                        <div id="builderResourceTree"></div>

                                    </uib-tab>

                                    <uib-tab heading="Text">
                                        <br/>
                                        <div><p ng-bind-html="currentResource.text.div"></p></div>
<!--
                                        <table class="table table-bordered">
                                            <tr ng-repeat="row in resourceAsArray">
                                                <td>{{row.title}}</td>
                                                <td>{{row.value}}</td>
                                            </tr>
                                        </table>
                                        -->

                                    </uib-tab>

                                    <uib-tab heading="Json">
                                        <br/>
                                        <pre>{{currentResource | json}}</pre>
                                    </uib-tab>


                                    <uib-tab heading="Direct edit">
                                        <br/>

                                        <div ng-hide="input.directEdit">
                                            <p>This option allows you to directly modify the resource json.
                                            This completely bypasses all checking and the resource can become invalid
                                                and unable to be updated via the Structure&Reference tab.<strong>You have been warned!</strong></p>
                                            <p>Click the 'Setup' link below to generate the Json text to edit. You can either edit in place,
                                            or copy the text from the edit box into an external editor - make the edits - and
                                            paste back again. This is likely easier (and safer)</p>
                                            <p>Click the 'Save' link to update the resource from the edit box.</p>



                                        </div>

                                        <button ng-hide="input.directEdit"
                                                class="btn btn-link" ng-click="setupDirectEdit()">Setup</button>

                                        <button ng-show="input.directEdit"
                                                class="btn btn-link" ng-click="saveDirectEdit(input.directEdit)">Save</button>

                                        <button ng-show="input.directEdit"
                                                class="btn btn-link" ng-click="cancelDirectEdit(input.directEdit)">Cancel</button>

                                        <textarea ng-show="input.directEdit" class="form-control" rows="20" ng-model="input.directEdit">

                                        </textarea>





                                    </uib-tab>

                                    <uib-tab heading="FHIRPath">
                                        <br/>
                                        <fhirpath resource="currentResource"></fhirpath>



                                        <pre>{{currentResource | json}}</pre>
                                    </uib-tab>




                                    <uib-tab heading="Summary">
                                        <br/>

                                        <div class="row">
                                            <div class="col-md-6 col-sm-6">
                                                <strong>Resource Type: </strong>{{currentResource.resourceType}}
                                            </div>

                                            <div class="col-md-6 col-sm-6">
                                                <strong>ID: </strong>{{currentResource.id}}
                                            </div>


                                        </div>


                                        <div class="rounded-box"><p ng-bind-html="currentResource.text.div"></p></div>

                                        <h4>Current References</h4>

                                        <div>
                                            <strong>From this resource</strong>
                                            <table class="table table-condensed table-bordered">
                                                <tr><th>Path</th><th>Target resource</th></tr>
                                                <tr ng-repeat="ref in currentResourceRefs.src">
                                                    <td>{{ref.path}}</td>
                                                    <td>{{ref.targ}}</td>

                                                </tr>
                                            </table>

                                            <strong>To this resource</strong>
                                            <table class="table table-condensed table-bordered">
                                                <tr><th>From</th><th>Source path</th></tr>
                                                <tr ng-repeat="ref in currentResourceRefs.targ">
                                                    <td>{{ref.src}}</td>
                                                    <td>{{ref.path}}</td>
                                                </tr>
                                            </table>
                                        </div>


                                    </uib-tab>

                                </uib-tabset>

                            </uib-tab>

                            <uib-tab>
                                <uib-tab-heading>Changes <span ng-show="tracker.length > 0" class="badge">{{tracker.length}}</span> </uib-tab-heading>
                                <div ng-controller="sbHistoryCtrl">
                                    <ul class="list-group">
                                        <li ng-repeat="item in tracker" class="list-group-item">

                                            {{$index+1}}. <strong>{{item.details.path}}</strong>
                                            <span ng-show="item.details.to">
                                                <strong>--> {{item.details.to.resourceType}}/{{item.details.to.id}}</strong>
                                            </span>

                                            <pre ng-hide="item.details.to">{{item.details.value | json}}</pre>
                                        </li>
                                    </ul>
                                </div>
                            </uib-tab>

                            <uib-tab heading="Dev Views" ng-show="1==2">
                                <h3>Views for clinFHIR developer</h3>
                                <em>This is development information used for debugging. Just ignore it...</em>

                                <uib-tabset>
                                    <uib-tab heading="ed">
                                        <pre>{{hashPath.ed | json}}</pre>
                                    </uib-tab>
                                    <uib-tab heading="hashPath">
                                        <pre>{{hashPath | json}}</pre>
                                    </uib-tab>
                                </uib-tabset>



                            </uib-tab>

                            <uib-tab heading="Errors/Warnings" ng-show="currentEntry.response.outcome">


                                <uib-tabset>
                                    <br/>
                                    <uib-tab heading="issues">
                                        <table class="table table-bordered">
                                            <tr><th>Severity</th><th>Details/Diagnostics</th></tr>
                                            <tr ng-repeat = "iss in currentEntry.response.outcome.issue">
                                                <td>{{iss.severity}}</td>
                                                <!--<td>{{iss.code}}</td>-->
                                                <td>{{iss.details.text}}
                                                    <div>{{iss.diagnostics}}</div>
                                                </td>
                                                <!--
                                                <td><div ng-repeat="loc in iss.location">{{loc}}</div></td>
                                                -->
                                            </tr>
                                        </table>
                                    </uib-tab>

                                    <uib-tab heading="json">
                                        <pre>{{currentEntry.response.outcome | json}}</pre>
                                    </uib-tab>


                                </uib-tabset>









                            </uib-tab>



                        </uib-tabset>




                    </uib-tabset>
                </div>


                <div ng-show="displayMode == 'new'">

                    <div class="row">
                        <div class="col-md-6 col-sm-6">
                            <h4>Add new Resource</h4>
                        </div>
                        <div class="col-md-6 col-sm-6">
                            <a target="_blank" class="pull-right"
                               ng-href="{{fhirBasePath}}resourceguide.html">
                                Overview of Resources in spec
                            </a>
                        </div>
                    </div>



                    <uib-tabset>
                        <uib-tab heading="Core resource">
                            <br/>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Resource Type:
                                </div>
                                <div class="col-md-6 col-sm-6">
                                    <select ng-model="input.newResource" class="form-control"
                                            ng-change="newTypeSelected(input.newResource)"
                                            ng-options="resource.name for resource in resources"></select>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Text
                                </div>
                                <div class="col-md-6 col-sm-6">
                                    <textarea class="form-control" ng-model="input.text"></textarea>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">

                                </div>
                                <div class="col-md-6 col-sm-6">
                                    <button  ng-show="input.newResource" class="btn btn-success pull-right"
                                             ng-click="addNewResource(input.newResource.name)">Add</button>
                                    <button class="btn btn-link pull-right"
                                            ng-click= "setDisplayMode( 'view')">Cancel</button>
                                </div>
                            </div>






                        </uib-tab>
                        <uib-tab heading="Profile">
                            <br/>

                            <div class="row">
                                <div class="col-md-2 col-sm-2">
                                    <button class="btn btn-default" ng-click="findProfile()">Find Profile</button>
                                </div>
                                <div class="col-md-10 col-sm-10">
                                    <div>{{selectedProfile.url}}</div>
                                </div>
                            </div>
                            <br/>

                            <div class="row" ng-show="input.selectedProfile">
                                <div class="col-md-3 col-sm-3">
                                    Text
                                </div>
                                <div class="col-md-6 col-sm-6">
                                    <textarea class="form-control" ng-model="input.text"></textarea>
                                </div>
                            </div>
                            <br/>
                            <div class="row">
                                <div class="col-md-3 col-sm-3">

                                </div>
                                <div class="col-md-6 col-sm-6" ng-show="input.selectedProfile">
                                    <button class="btn btn-success pull-right"
                                            ng-click="addSelectedProfile(input.selectedProfile)">Add</button>
                                    <button class="btn btn-link pull-right" ng-click= "setDisplayMode( 'view')">Cancel</button>
                                </div>
                            </div>

                            <br/><br/>
                            <div style="margin-left: 30px">
                                <h5>Notes on support of profiles resource types.</h5>
                                <p>There are currently a number of limitations on the support for profiles in the Scenario Builder</p>
                                <ul>
                                    <li>Only resources created by clinFHIR will work. Others might. but no guarantees</li>
                                    <li>Simple extensions only - ie extensions that have only a single value</li>
                                    <li>The extension can only have a single datatype</li>
                                    <li>The extension cannot be applied to primitive elements (like a string)</li>
                                    <li>Only one of each extension type can be in the resource</li>

                                </ul>
                            </div>



                        </uib-tab>


                        <uib-tab heading="Logical Model">
                            <br/>
<!--
                            <button class="btn btn-default" ng-click="findLogicalModel()">Find Logical Model</button>
                            <br/><br/>
                            -->
                            <div class="row">
                                <div class="col-md-3 col-sm-3">
                                    Model name:
                                </div>
                                <div class="col-md-6 col-sm-6">
                                    <select ng-model="input.selectLM" class="form-control"
                                            ng-changeDEP="selectLogicalModelFromList(input.selectLM,$index)"
                                            ng-options="entry.resource.name for entry in bundleLogicalModels.entry"></select>
                                </div>
                                <div class="col-md-3 col-sm-3">
                                    <button class="btn btn-success"
                                            ng-click="selectLogicalModelFromList(input.selectLM)">Add</button>
                                </div>

                            </div>




                            <br/>

                            <div style="margin-left: 30px">
                                <h5>Notes on support of Logical Models.</h5>
                                <p>Resources based on Logical models will be built and saved in the builder,
                                    but cannot be persisted to a FHIR server as a discrete resource when that functionity
                                is enabled</p>

                            </div>





<!--
                            <div><input type="text" class="form-control"
                                        placeholder="Filter model list by id" ng-model="input.filter"
                                        ng-change="filterModelList(input.filter)"/> </div>

                            <ul class="list-group" style=" height:700px; overflow: auto;" >
                                <li style="cursor: pointer" ng-class="{'list-group-item':1==1,'list-group-item-info':SD.type == entry.resource.type}"
                                    ng-repeat="entry in bundleLogicalModels.entry"
                                    ng-click="selectLogicalModelFromList(entry,$index)">

                                    <div class="row">
                                        <div class="col-md-9 col-sm-9">
                                            <h4>{{entry.resource.name}}</h4>
                                        </div>
                                        <div class="col-md-3 col-sm-3">
                                            <em class="pull-right">{{entry.resource.status}}</em>
                                        </div>
                                    </div>

                                    {{entry.resource.description | limitTo : 200}}
                                </li>
                            </ul>
-->



                        </uib-tab>

                        <uib-tab heading="Existing resources" ng-show="resourcesFromServer">

                            <div class="row">

                                <div class="col-md-5 col-sm-5">
                                    <h4>Resource Types</h4>
                                    <div class="list-group">
                                        <a href="#"  ng-click="input.selectedTypeFromServer = key"
                                           ng-class="{'list-group-item':true,'active':key == input.selectedTypeFromServer}"
                                           ng-repeat="(key,value) in resourcesFromServer">
                                            {{key}}
                                            <span class="pull-right badge">{{value.total}}</span>
                                        </a>
                                    </div>


                                </div>

                                <div class="col-md-7 col-sm-7">

                                    <h4>{{input.selectedTypeFromServer}} resources</h4>

                                    <div class="list-group">
                                        <div
                                           ng-class="{'list-group-item':true,'active':entry.resource.id == outcome.selectedResource.id}"
                                           ng-repeat="entry in resourcesFromServer[input.selectedTypeFromServer].entry">


                                                <div class="row">
                                                    <div class="col-md-10 col-sm-10">
                                                        {{ResourceUtilsSvc.getOneLineSummaryOfResource(entry.resource)}}
                                                    </div>
                                                    <div class="col-md-2 col-sm-2">
                                                        <i class="glyphicon glyphicon-plus"
                                                           ng-click="resourceFromServerSelected(
                                                           resourcesFromServer[input.selectedTypeFromServer],$index)"
                                                           style="cursor: pointer">

                                                        </i>
                                                    </div>
                                                </div>



                                        </div>
                                    </div>
                                </div>


                            </div>




                        </uib-tab>


                    </uib-tabset>




<!--
                    <div class="row" ng-show="currentType">
                        <div class="col-md-12 col-sm-12">
                            <br/>

                            <uib-tabset>
                                <uib-tab heading="New resource instance">
                                    <br/>
                                    <div class="row">
                                        <div class="col-md-2 col-sm-2">
                                            Text
                                        </div>
                                        <div class="col-md-10 col-sm-10">
                                            <textarea class="form-control" ng-model="input.text"></textarea>
                                        </div>
                                    </div>

                                    <div class="row">



                                        <div class="col-md-2 col-sm-2">

                                        </div>
                                        <div class="col-md-10 col-sm-10">
                                            <br/>

                                            <button class="btn btn-success pull-right" ng-click="addNewResource(input.newResource.name)">Add</button>
                                            <button class="btn btn-link pull-right" ng-click= "setDisplayMode( 'view')">Cancel</button>



                                        </div>
                                    </div>


                                </uib-tab>

                                <uib-tab heading="About this resource type">

                                    <div>
                                        <a target="_blank" class="pull-right"
                                           ng-href="{{fhirBasePath}}{{input.newResource.name | lowercase}}.html">
                                            View in spec
                                        </a>
                                    </div>

                                    <h5>Description</h5>


                                    {{currentType.description}}
                                    {{currentType.purpose}}

                                    <h5>Potential references</h5>
                                    <table class="table table-bordered table-condensed">
                                        <tr><th>Path</th><th>Description</th><th>Resource Type</th></tr>
                                        <tr ng-repeat="ref in references">
                                            <td>{{ref.path | dropFirstInPath}}</td>
                                            <td>{{ref.ed.short}}</td>
                                            <td>{{ref.profile | getLogicalID}}</td>

                                        </tr>
                                    </table>
                                </uib-tab>
                            </uib-tabset>

                        </div>
                    </div>
                    -->






                </div>

            </div>

        </div>



        <!-- Sceario Builder support directives  -->

        <vs-browser trigger="showVSBrowserDialog" hidesearch="true"
                    concept-selected="selectConceptFromVSBrowser" vs-selected="vsSelected"></vs-browser>


        <!-- a directive that allows a profile to be selected - not just a base one... -->

        <select-profile trigger="showFindProfileDialog"
                        all-resource-types="resources"
                        profile-selected="selectedProfileFromDialog" type="'profile'">

        </select-profile>

    </div>
</body>
</html>